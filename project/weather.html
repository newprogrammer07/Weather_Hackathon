<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Vibe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
   
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background 1s ease-in-out;
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .weather-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #8b5cf6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .icon-btn { display: inline-flex; align-items: center; justify-content: center; }

        .bg-default { background: linear-gradient(135deg, #6d60e657, #5e52dc, #2525d5); }
        .bg-sunny { background: linear-gradient(to bottom, #4a90e2, #fbc2eb); }
        .bg-cloudy { background: linear-gradient(to bottom, #6777a5, #7399df); }
        .bg-rainy { background: linear-gradient(to bottom, #597898, #185b65); }
        .bg-stormy { background: linear-gradient(to bottom, #232526, #414345); }
        .bg-foggy { background: linear-gradient(to bottom, #bdc3c7, #2c3e50); }

        .gemini-loader { width:20px; height:20px; border-width:3px; }
        @media (max-width: 640px) {
            body {
                padding: 0.5rem;
                align-items: flex-start;
                padding-top: 2rem;
            }
            .weather-card {
                margin: 0;
            }
            .temperature-display {
                flex-direction: column;
                text-align: center;
            }
            .temperature-display .weather-icon {
                margin-right: 0;
                margin-bottom: 1rem;
            }
        }

        @media (min-width: 1024px) {
            .temperature-display {
                flex-direction: column !important;
                text-align: center !important;
            }
            .temperature-display .weather-icon {
                margin-right: 0 !important;
                margin-bottom: 1rem !important;
            }
        }
        /* Color Change 4x Animation */
@-webkit-keyframes color-change-4x {
  0% { background: #196cea; }
  33.3333% { background: #b2c7ef; }
  66.666% { background: #d74f4f; }
  100% { background: #dfc058; }
}

@keyframes color-change-4x {
  0% { background: #5691ea; }
  33.3333% { background: #b2c7ef; }
  66.666% { background: #de6868; }
  100% { background: #f4dc8d; }
}

.color-change-4x {
  -webkit-animation: color-change-4x 15s linear infinite alternate both;
  animation: color-change-4x 15s linear infinite alternate both;
}
    </style>
</head>

<body  class="color-change-4x">
    <div id="rain-overlay"></div>

    <div class="max-w-md lg:max-w-4xl w-full">
        <h1 class="text-4xl sm:text-5xl font-black text-white text-center mb-4 sm:mb-6 tracking-tight drop-shadow-lg">Weather Vibe</h1>

        <!-- Search & Location Controls -->
        <div class="lg:flex lg:gap-4 lg:mb-6">
            <div class="relative mb-3 sm:mb-4 lg:mb-0 lg:flex-1">
                <input type="text" id="city-input" placeholder="Enter city name..." class="w-full py-3 px-4 pr-16 sm:pr-20 rounded-full bg-white/30 text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50 border-none shadow-md text-sm sm:text-base">
                <button id="search-btn" class="absolute right-2 top-1/2 -translate-y-1/2 bg-blue-600 hover:bg-blue-700 rounded-full p-2 icon-btn transition-colors">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="11" cy="11" r="8"></circle>
        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
    </svg>
</button> 

            </div>
            <button id="location-btn" class="w-full lg:w-auto lg:px-6 py-2.5 px-4 mb-3 sm:mb-4 lg:mb-0 rounded-full bg-white/20 hover:bg-white/30 text-white font-semibold flex items-center justify-center transition-colors shadow-md text-sm sm:text-base">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                Use My Location
            </button>
        </div>



<div id="major-cities-container">
    <h2 class="text-2xl font-bold text-white text-center mb-4">Major Indian Cities</h2>
    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6">
  
        <button onclick="fetchCityWeather('Mumbai')" class="relative text-white font-bold rounded-xl overflow-hidden shadow-lg h-32 sm:h-40 transform hover:scale-105 transition-transform duration-300 ease-in-out bg-cover bg-center" style="background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT0P129-PYUdBsRPbcSxVKRuFJoIuuUU0TTKg&s');">
            <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
            <div class="absolute bottom-0 left-0 p-3">
                <p>Mumbai</p>
                <p class="font-normal text-sm opacity-90">Maharashtra</p>
            </div>
        </button>
   
        <button onclick="fetchCityWeather('New Delhi')" class="relative text-white font-bold rounded-xl overflow-hidden shadow-lg h-32 sm:h-40 transform hover:scale-105 transition-transform duration-300 ease-in-out bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1587474260584-136574528ed5?fm=jpg&q=60&w=3000&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8ZGVsaGl8ZW58MHx8MHx8fDA%3D');">
            <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
            <div class="absolute bottom-0 left-0 p-3">
                <p>New Delhi</p>
                <p class="font-normal text-sm opacity-90">National Capital</p>
            </div>
        </button>
     
        <button onclick="fetchCityWeather('Bengaluru')" class="relative text-white font-bold rounded-xl overflow-hidden shadow-lg h-32 sm:h-40 transform hover:scale-105 transition-transform duration-300 ease-in-out bg-cover bg-center" style="background-image: url('https://www.holidify.com/images/bgImages/BANGALORE.jpg');">
            <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
            <div class="absolute bottom-0 left-0 p-3">
                <p>Bangalore</p>
                <p class="font-normal text-sm opacity-90">Karnataka</p>
            </div>
        </button>
        
        <button onclick="fetchCityWeather('Chennai')" class="relative text-white font-bold rounded-xl overflow-hidden shadow-lg h-32 sm:h-40 transform hover:scale-105 transition-transform duration-300 ease-in-out bg-cover bg-center" style="background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTqiczlhhd3e9n0bqqxjXIMTLWk0y6IOg7U6Q&s');">
            <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
            <div class="absolute bottom-0 left-0 p-3">
                <p>Chennai</p>
                <p class="font-normal text-sm opacity-90">Tamil Nadu</p>
            </div>
        </button>
    
         <button onclick="fetchCityWeather('Kolkata')" class="relative text-white font-bold rounded-xl overflow-hidden shadow-lg h-32 sm:h-40 transform hover:scale-105 transition-transform duration-300 ease-in-out bg-cover bg-center" style="background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQdpCuUIMDn4Ol89LyRYHRgi3PkYyaKrGJyWPx-RESlxIiZE68_');">
            <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
            <div class="absolute bottom-0 left-0 p-3">
                <p>Kolkata</p>
                <p class="font-normal text-sm opacity-90">West Bengal</p>
            </div>
        </button>
       
         <button onclick="fetchCityWeather('Hyderabad')" class="relative text-white font-bold rounded-xl overflow-hidden shadow-lg h-32 sm:h-40 transform hover:scale-105 transition-transform duration-300 ease-in-out bg-cover bg-center" style="background-image: url('https://external-preview.redd.it/this-video-by-md-siraj-never-gets-old-v0-aXVhZWk5bHpxbHFjMRSUhbT6vK9T5levpkW20CnQwon704KC8m0sj-Mro_gN.png?format=pjpg&auto=webp&s=e569869e78be9f8856edf9d2364ba68c5ce90132');">
            <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
            <div class="absolute bottom-0 left-0 p-3">
                <p>Hyderabad</p>
                <p class="font-normal text-sm opacity-90">Telangana</p>
            </div>
        </button>
      
         <button onclick="fetchCityWeather('Bhubaneswar')" class="relative text-white font-bold rounded-xl overflow-hidden shadow-lg h-32 sm:h-40 transform hover:scale-105 transition-transform duration-300 ease-in-out bg-cover bg-center" style="background-image: url('https://upload.wikimedia.org/wikipedia/commons/5/55/NaveenPatnaik.jpg');">
            <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
            <div class="absolute bottom-0 left-0 p-3">
                <p>Bhubaneswar</p>
                <p class="font-normal text-sm opacity-90">Odisha</p>
            </div>
        </button>

        <button onclick="fetchCityWeather('Ahmedabad')" class="relative text-white font-bold rounded-xl overflow-hidden shadow-lg h-32 sm:h-40 transform hover:scale-105 transition-transform duration-300 ease-in-out bg-cover bg-center" style="background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQtOZarhihNQ0chqWlktiNffsIAi_l9wOZlbQ&s');">
            <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
            <div class="absolute bottom-0 left-0 p-3">
                <p>Ahmedabad</p>
                <p class="font-normal text-sm opacity-90">Gujarat</p>
            </div>
        </button>
    </div>
</div>


      
        <div id="weather-container" class="weather-card rounded-3xl p-4 sm:p-6 md:p-8 text-white shadow-2xl w-full text-center">
            
            <div id="welcome-message">
                <h2 class="text-xl sm:text-2xl font-bold">Check the Vibe !</h2>
                <p class="mt-2 opacity-80 text-sm sm:text-base">Search for a city or use your location to get the latest weather.</p>
            </div>

            <div id="loader" class="hidden flex-col items-center justify-center">
                <div class="loader mb-4"></div>
                <p id="loader-text" class="text-base sm:text-lg">Fetching the vibe...</p>
            </div>

            <div id="weather-data" class="hidden">
            
                <div class="lg:grid lg:grid-cols-2 lg:gap-8 lg:items-start">
                    <div class="lg:text-center">
                        <h1 id="city" class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold tracking-wide">--</h1>
                        <p id="date" class="text-xs sm:text-sm lg:text-base opacity-80 mb-4 sm:mb-6">--</p>
                        <div class="temperature-display flex items-center justify-center my-4 sm:my-6 lg:flex-col lg:my-8">
                            <div id="weather-icon" class="weather-icon w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 lg:w-32 lg:h-32 mr-0 sm:mr-4 lg:mr-0 lg:mb-4"></div>
                            <div>
                                <p id="temperature" class="text-5xl sm:text-6xl md:text-7xl lg:text-8xl font-bold">--°C</p>
                                <p id="description" class="text-lg sm:text-xl lg:text-2xl capitalize">--</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3 sm:gap-4 lg:gap-6 text-left mt-6 sm:mt-8 bg-white/20 p-3 sm:p-4 lg:p-6 rounded-xl">
                            <div><p class="font-semibold text-sm sm:text-base lg:text-lg">Wind Speed</p><p id="wind-speed" class="text-sm sm:text-base lg:text-lg">-- km/h</p></div>
                            <div><p class="font-semibold text-sm sm:text-base lg:text-lg">Feels Like</p><p id="apparent-temperature" class="text-sm sm:text-base lg:text-lg">-- °C</p></div>
                        </div>
                    </div>

                    <div class="lg:space-y-6">
            
                        <div class="mt-6 sm:mt-8 lg:mt-0">
                            <h3 class="text-lg sm:text-xl lg:text-2xl font-bold text-left mb-2 lg:mb-4">Hourly Vibe</h3>
                            <div class="bg-white/20 p-3 sm:p-4 lg:p-6 rounded-xl">
                                <canvas id="hourly-chart" style="max-height: 200px;"></canvas>
                            </div>
                        </div>

                        <!-- 7-Day Forecast -->
                        <div class="mt-6 sm:mt-8 lg:mt-0">
                            <h3 class="text-lg sm:text-xl lg:text-2xl font-bold text-left mb-2 lg:mb-4">Weekly Vibe</h3>
                            <div id="daily-forecast-container" class="grid grid-cols-3 sm:grid-cols-4 lg:grid-cols-7 gap-2 lg:gap-3 text-center">
                                <!-- Daily forecast items will be injected here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gemini Features Section -->
                <div id="gemini-features" class="mt-6 sm:mt-8 lg:mt-12">
                    <div class="lg:grid lg:grid-cols-2 lg:gap-6 space-y-3 sm:space-y-4 lg:space-y-0">
                        <div>
                            
                            <div id="gemini-outfit-container" class="hidden mt-3 sm:mt-4 lg:mt-6 bg-black/20 p-3 sm:p-4 lg:p-6 rounded-xl text-left">
                                <p class="font-semibold mb-2 text-sm sm:text-base lg:text-lg">Outfit Vibe:</p>
                                <div id="gemini-outfit-loader" class="loader gemini-loader hidden"></div>
                                <p id="gemini-outfit-text" class="text-sm sm:text-base lg:text-lg leading-relaxed"></p>
                            </div>
                        </div>
                        <div>
                            
                            <div id="gemini-activity-container" class="hidden mt-3 sm:mt-4 lg:mt-6 bg-black/20 p-3 sm:p-4 lg:p-6 rounded-xl text-left">
                                <p class="font-semibold mb-2 text-sm sm:text-base lg:text-lg">Activity Vibe:</p>
                                <div id="gemini-activity-loader" class="loader gemini-loader hidden"></div>
                                <p id="gemini-activity-text" class="text-sm sm:text-base lg:text-lg leading-relaxed"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="error-message" class="hidden text-center">
                 <p class="text-lg sm:text-xl font-semibold">Vibe Check Failed!</p>
                 <p id="error-details" class="mt-2 text-sm sm:text-base">Could not fetch weather data.</p>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Element References ---
        const bodyEl = document.body;
        const rainOverlay = document.getElementById('rain-overlay');
        const cityInput = document.getElementById('city-input');
        const searchBtn = document.getElementById('search-btn');
        const locationBtn = document.getElementById('location-btn');
        const welcomeMessage = document.getElementById('welcome-message');
        const loader = document.getElementById('loader');
        const loaderText = document.getElementById('loader-text');
        const weatherDataEl = document.getElementById('weather-data');
        const errorMessage = document.getElementById('error-message');
        const errorDetails = document.getElementById('error-details');
        const cityEl = document.getElementById('city');
        const dateEl = document.getElementById('date');
        const tempEl = document.getElementById('temperature');
        const descEl = document.getElementById('description');
        const windEl = document.getElementById('wind-speed');
        const apparentTempEl = document.getElementById('apparent-temperature');
        const iconEl = document.getElementById('weather-icon');
        const dailyForecastContainer = document.getElementById('daily-forecast-container');
        const hourlyChartCanvas = document.getElementById('hourly-chart');
        
        const geminiFeatures = document.getElementById('gemini-features');
        const geminiOutfitBtn = document.getElementById('gemini-outfit-btn');
        const geminiOutfitContainer = document.getElementById('gemini-outfit-container');
        const geminiOutfitLoader = document.getElementById('gemini-outfit-loader');
        const geminiOutfitText = document.getElementById('gemini-outfit-text');
        const geminiActivityBtn = document.getElementById('gemini-activity-btn');
        const geminiActivityContainer = document.getElementById('gemini-activity-container');
        const geminiActivityLoader = document.getElementById('gemini-activity-loader');
        const geminiActivityText = document.getElementById('gemini-activity-text');
        
        let currentWeatherData = {};
        let hourlyChart = null; // To hold the chart instance

        // --- Weather Icons Mapping (WMO Codes) ---
        const weatherIcons = {
            0: { name: 'Clear sky', icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>' },
            1: { name: 'Mainly clear', icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"/><path d="M22 10a3 3 0 0 0-3-3h-2.207a5.502 5.502 0 0 0-10.702.5"/></svg>' },
            2: { name: 'Partly cloudy', icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"/></svg>' },
            3: { name: 'Overcast', icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"/><path d="M22 10a3 3 0 0 0-3-3h-2.207a5.502 5.502 0 0 0-10.702.5"/></svg>' },
            45: { name: 'Fog', icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12h20"/><path d="M5 16h14"/><path d="M5 8h14"/></svg>' },
            48: { name: 'Depositing rime fog', icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12h20"/><path d="M5 16h14"/><path d="M5 8h14"/></svg>' },
            51: { name: 'Light drizzle', icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 13.3a5 5 0 1 1-5-5h5a3 3 0 0 1 3 3v0a3 3 0 0 1-3 3z"/><path d="M12 12h.01"/><path d="M8 16.01h.01"/><path d="M8 20.01h.01"/><path d="M12 16.01h.01"/><path d="M12 20.01h.01"/><path d="M16 16.01h.01"/><path d="M16 20.01h.01"/></svg>' },
            61: { name: 'Slight rain', icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 13.3a5 5 0 1 1-5-5h5a3 3 0 0 1 3 3v0a3 3 0 0 1-3 3z"/><path d="M12 12h.01"/><path d="M8 16.01h.01"/><path d="M12 16.01h.01"/><path d="M16 16.01h.01"/></svg>' },
            63: { name: 'Moderate rain', icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 13.3a5 5 0 1 1-5-5h5a3 3 0 0 1 3 3v0a3 3 0 0 1-3 3z"/><path d="M12 12h.01"/><path d="M8 16.01h.01"/><path d="M8 20.01h.01"/><path d="M12 16.01h.01"/><path d="M12 20.01h.01"/><path d="M16 16.01h.01"/><path d="M16 20.01h.01"/></svg>' },
            80: { name: 'Slight rain showers', icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M160 384C107 384 64 341 64 288C64 245.5 91.6 209.4 129.9 196.8C128.6 190.1 128 183.1 128 176C128 114.1 178.1 64 240 64C283.1 64 320.5 88.3 339.2 124C353.9 106.9 375.7 96 400 96C444.2 96 480 131.8 480 176C480 181.5 479.4 186.8 478.4 192C478.9 192 479.5 192 480 192C533 192 576 235 576 288C576 341 533 384 480 384L160 384zM161.6 452.2C162.7 449.7 165.2 448 168 448C170.8 448 173.3 449.6 174.4 452.2L204.6 520.4C206.8 525.5 208 530.9 208 536.4C208 558.3 189.9 576 168 576C146.1 576 128 558.3 128 536.4C128 530.9 129.2 525.4 131.4 520.4L161.6 452.2zM313.6 452.2C314.7 449.7 317.2 448 320 448C322.8 448 325.3 449.6 326.4 452.2L356.6 520.4C358.8 525.5 360 530.9 360 536.4C360 558.3 341.9 576 320 576C298.1 576 280 558.3 280 536.4C280 530.9 281.2 525.4 283.4 520.4L313.6 452.2zM435.4 520.4L465.6 452.2C466.7 449.7 469.2 448 472 448C474.8 448 477.3 449.6 478.4 452.2L508.6 520.4C510.8 525.5 512 530.9 512 536.4C512 558.3 493.9 576 472 576C450.1 576 432 558.3 432 536.4C432 530.9 433.2 525.4 435.4 520.4z"/></svg>' },
            95: { name: 'Thunderstorm', icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.74 15.24a2 2 0 0 0-1.2-3.35l-1.93-.26a3 3 0 0 0-2.43 1.25l-.47.7A6.001 6.001 0 0 0 9 12.5H8a5.5 5.5 0 0 0-5.5 5.5v0A5.5 5.5 0 0 0 8 23.5h7a5.5 5.5 0 0 0 5.4-4.4l.6-3.86Z"/><path d="m16 13-4 5h4l-4 5"/></svg>' }
        };

        // --- UI & Background Logic ---
        function showUI(state, message = "") {
            welcomeMessage.classList.add('hidden');
            loader.classList.add('hidden');
            weatherDataEl.classList.add('hidden');
            errorMessage.classList.add('hidden');
            geminiFeatures.classList.add('hidden');
            geminiOutfitContainer.classList.add('hidden');
            geminiActivityContainer.classList.add('hidden');
            geminiOutfitText.textContent = '';
            geminiActivityText.textContent = '';

            switch(state) {
                case 'loading':
                    loaderText.textContent = message;
                    loader.classList.remove('hidden');
                    break;
                case 'data':
                    weatherDataEl.classList.remove('hidden');
                    geminiFeatures.classList.remove('hidden');
                    break;
                case 'error':
                    errorDetails.textContent = message;
                    errorMessage.classList.remove('hidden');
                    break;
                default:
                    welcomeMessage.classList.remove('hidden');
                    break;
            }
        }

        function updateBackground(weatherCode) {
            bodyEl.className = '';
            rainOverlay.classList.remove('rain-animation');
            if (weatherCode >= 0 && weatherCode <= 1) bodyEl.classList.add('bg-sunny');
            else if (weatherCode >= 2 && weatherCode <= 3) bodyEl.classList.add('bg-cloudy');
            else if (weatherCode >= 45 && weatherCode <= 48) bodyEl.classList.add('bg-foggy');
            else if ((weatherCode >= 51 && weatherCode <= 67) || (weatherCode >= 80 && weatherCode <= 82)) {
                bodyEl.classList.add('bg-rainy');
                rainOverlay.classList.add('rain-animation');
            } else if (weatherCode >= 95 && weatherCode <= 99) {
                bodyEl.classList.add('bg-stormy');
                rainOverlay.classList.add('rain-animation');
            } else bodyEl.classList.add('bg-default');
        }

        // --- Core Weather Functions ---
        async function getWeather(lat, lon, name) {
            const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,apparent_temperature,weather_code,wind_speed_10m&hourly=temperature_2m&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto`;
            try {
                showUI('loading', `Checking vibe for ${name}...`);
                const response = await fetch(weatherUrl);
                if (!response.ok) throw new Error(`API error: ${response.status}`);
                const data = await response.json();
                updateUI(data, name);
            } catch (error) {
                showUI('error', `Could not fetch weather. ${error.message}`);
            }
        }
        
        function updateUI(data, name) {
            const { current, hourly, daily } = data;
            currentWeatherData = current; 
            updateBackground(current.weather_code);

           
            cityEl.textContent = name.split(',')[0];
            dateEl.textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
            tempEl.textContent = `${Math.round(current.temperature_2m)}°C`;
            windEl.textContent = `${(current.wind_speed_10m * 3.6).toFixed(1)} km/h`;
            apparentTempEl.textContent = `${Math.round(current.apparent_temperature)}°C`;
            const weatherInfo = weatherIcons[current.weather_code] || { name: 'Unknown', icon: weatherIcons[0].icon };
            descEl.textContent = weatherInfo.name;
            iconEl.innerHTML = weatherInfo.icon;

          
            sessionStorage.setItem('dailyData', JSON.stringify(daily));
            
      
            renderHourlyChart(hourly);
            renderDailyForecast(daily);

            showUI('data');
        }

        function renderHourlyChart(hourlyData) {
            if (hourlyChart) {
                hourlyChart.destroy(); 
            }

            const now = new Date();
            const currentHour = now.getHours();
            
            const labels = hourlyData.time.slice(currentHour, currentHour + 24).map(t => new Date(t).getHours() + ':00');
            const temps = hourlyData.temperature_2m.slice(currentHour, currentHour + 24);

            hourlyChart = new Chart(hourlyChartCanvas, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Temperature',
                        data: temps,
                        borderColor: 'rgba(255, 255, 255, 0.8)',
                        backgroundColor: 'rgba(255, 255, 255, 0.2)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (context) => `${context.parsed.y}°C`
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { 
                                color: 'white',
                                font: { size: 10 }
                            },
                            grid: { display: false }
                        },
                        y: {
                            ticks: { 
                                color: 'white',
                                font: { size: 10 }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.2)' }
                        }
                    }
                }
            });
        }

        function renderDailyForecast(dailyData) {
            dailyForecastContainer.innerHTML = ''; 
            const numDays = window.innerWidth < 1024 ? (window.innerWidth < 640 ? 4 : 7) : 7; 
            
            for (let i = 0; i < numDays; i++) {
                const day = new Date(dailyData.time[i]);
                const dayName = i === 0 ? 'Today' : day.toLocaleDateString('en-US', { weekday: 'short' });
                
                const weatherInfo = weatherIcons[dailyData.weather_code[i]] || weatherIcons[0];

                const dayEl = document.createElement('div');
                dayEl.className = 'bg-white/20 p-2 sm:p-3 lg:p-4 rounded-lg flex flex-col items-center';
                dayEl.innerHTML = `
                    <p class="font-semibold text-xs sm:text-sm lg:text-base">${dayName}</p>
                    <div class="w-6 h-6 sm:w-8 sm:h-8 lg:w-10 lg:h-10 my-1">${weatherInfo.icon}</div>
                    <p class="text-xs sm:text-sm lg:text-base font-semibold">${Math.round(dailyData.temperature_2m_max[i])}°</p>
                    <p class="text-xs lg:text-sm opacity-70">${Math.round(dailyData.temperature_2m_min[i])}°</p>
                `;
                dailyForecastContainer.appendChild(dayEl);
            }
        }

        // --- Other Functions (Search, Location, Gemini) ---
        async function getCityName(lat, lon) { 
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
                const data = await response.json();
                return data.address.city || data.address.town || data.address.village || data.display_name || 'Unknown Location';
            } catch (error) {
                console.error('Error fetching city name:', error);
                return 'Unknown Location';
            }
        }

        function getUserLocation() { 
            if (navigator.geolocation) { 
                showUI('loading', 'Getting your location...'); 
                navigator.geolocation.getCurrentPosition(
                    async position => { 
                        try { 
                            const city = await getCityName(position.coords.latitude, position.coords.longitude); 
                            getWeather(position.coords.latitude, position.coords.longitude, city); 
                        } catch (error) { 
                            showUI('error', `Could not find city name. ${error.message}`); 
                        } 
                    }, 
                    error => {
                        showUI('error', `Location access denied. ${error.message}`);
                    }
                ); 
            } else {
                showUI('error', "Geolocation is not supported.");
            }
        }

        async function handleSearch() { 
            const city = cityInput.value.trim(); 
            if (city) { 
                showUI('loading', `Checking vibe for ${city}...`); 
                try { 
                    const response = await fetch(`https://nominatim.openstreetmap.org/search?city=${city}&format=json&limit=1`); 
                    const data = await response.json(); 
                    if (data && data.length > 0) { 
                        getWeather(data[0].lat, data[0].lon, data[0].display_name); 
                    } else { 
                        showUI('error', `Could not find "${city}".`); 
                    } 
                } catch (error) { 
                    showUI('error', `Failed to search. ${error.message}`); 
                } 
            } else { 
                showUI('error', 'Please enter a city name.'); 
            } 
        }
        async function fetchCityWeather(city) {
    showUI('loading', `Checking vibe for ${city}...`);
    try {
        const response = await fetch(`https://nominatim.openstreetmap.org/search?city=${city}&format=json&limit=1`);
        const data = await response.json();
        if (data && data.length > 0) {
            getWeather(data[0].lat, data[0].lon, city);
        } else {
            showUI('error', `Could not find location for ${city}`);
        }
    } catch (error) {
        showUI('error', `Error fetching weather for ${city}: ${error.message}`);
    }
}

       
        // --- Event Listeners ---
        searchBtn.addEventListener('click', handleSearch);
        cityInput.addEventListener('keyup', (event) => { if (event.key === 'Enter') handleSearch(); });
        locationBtn.addEventListener('click', getUserLocation);
        ;

        // Handle window resize for responsive daily forecast
        window.addEventListener('resize', () => {
            if (currentWeatherData && Object.keys(currentWeatherData).length > 0) {
                // Re-render daily forecast when window is resized
                const dailyData = JSON.parse(sessionStorage.getItem('dailyData'));
                if (dailyData) {
                    renderDailyForecast(dailyData);
                }
            }
        }
    
    
    );
        
    </script>
</body>
</html>